# Serial Peripheral Interface (SPI)

## Introduction
- Synchronous and full duplex communication between a master and several slave devices
- Used two pins for data transfer SDIN and SDO -or- MOSI and MISO
- There is a SCLK pin to synchronize data transfer between two chips
- There is also a CE pin which is used to initiate and terminate the data transfer
- Total four pins
  - SDI = MOSI
  - SDO = MISO
  - SCLK = SCK
  - CE = SS

## SPI Protocol - Pin Functions

- MOSI: **Master Out Slave In**, used to send data from master to slave
- MISO: **Master In Slave Out**, used to send data from slave device to master
- SCk: **Serial Clock** used to generate clock to synchronize data transfer between the master and slave device. Generated by master.
- SS: **Slave Select**, used to select a particular slave in the SPI multiple slaves configuration.

## SPI Protocol - How it works

![SPI Working](https://user-images.githubusercontent.com/84496147/158118113-07edac80-c38d-4448-aaaf-4e2bde8f1256.PNG)

- Transaction is started by enabling SCK
- The master sets the SS line of the slave LOW
- Two registers of th same size are involved in transmission, one in the master and one in the slave.
  - Data is usually shifted out with MSB first while shifting a new least significant bit into the same register
  - At the same time, data from the slave is shifted into the least significant bit of the register
  - By the end of shifting all the register bits out in, the master and slave data would be exchanged data
- If more data needs to be exchanged, the shift registers will be reloaded and the process of exchange will start again
- When no more data is to be transmitted, the master stops toggling the SCK line and deselects the slave device.

## SPI Protocol - Clock phase and polarity

- Master and slave device must agree on clock phase and polarity
- **CPOL** - Clock Polarity
- **CPHA** - Clock Phase
- Combinations of CPOL and CPHA are refered to as SPI Bus modes, here four modes
  - MODE 0 = CPOL (0) || CPHA (0)
  - MODE 1 = CPOL (0) || CPHA (1)
  - MODE 2 = CPOL (1) || CPHA (0)
  - MODE 3 = CPOL (1) || CPHA (1)
- CPOL = 0, means sampling on the first edge
- CPOL = 1, means sampling on the second edge

## SPI Protocol - NSS Management

- NSS Software Mode
  - SS line is driven internally by the firmware

- NSS Hardware mode
  - A dedicated GPIO pin is used to drive the SS line

  - NSS Output enabled:
    - Used only when device operated in master mode
  
  - NSS Output disabled:
    - Allows multi-master capability for devices operating in master mode.

### TI MODE
 - NSS Hardware mode must be used
 - CPHA and CPOL are forced to conform to TEXAS Instrument Protocol requirements
 - In this mode NSS signal pulses at the end of every transmitted byte.
 
 
 


